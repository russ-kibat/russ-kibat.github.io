<!DOCTYPE html>
<html>
  <head>
    <title>Hotel Review Analysis Using NLP Part 1 – Russ Kibat – Data Scientist</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Understanding how customers respond to thier stay through reviews is vital responding to changes in customer expecations and remaining competitive in the the hotel market. Feedback comes in the form of reviews with positive feedback and negative feedback. This notebook will explore 225 MB of hotel review data and prepare it for a classifiation modeling. The end goal will be to read reviews and predict the overall rating a customer gives thier experience at the hotel.
" />
    <meta property="og:description" content="Understanding how customers respond to thier stay through reviews is vital responding to changes in customer expecations and remaining competitive in the the hotel market. Feedback comes in the form of reviews with positive feedback and negative feedback. This notebook will explore 225 MB of hotel review data and prepare it for a classifiation modeling. The end goal will be to read reviews and predict the overall rating a customer gives thier experience at the hotel.
" />
    
    <meta name="author" content="Russ Kibat" />

    
    <meta property="og:title" content="Hotel Review Analysis Using NLP Part 1" />
    <meta property="twitter:title" content="Hotel Review Analysis Using NLP Part 1" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Russ Kibat - Data Scientist" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://raw.githubusercontent.com/russ-kibat/russ-kibat.github.io/master/images/profile_picture.jpg" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Russ Kibat</a></h1>
            <p class="site-description">Data Scientist</p>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>Hotel Review Analysis Using NLP Part 1</h1>

  <div class="entry">
    <p>Understanding how customers respond to thier stay through reviews is vital responding to changes in customer expecations and remaining competitive in the the hotel market. Feedback comes in the form of reviews with positive feedback and negative feedback. This notebook will explore 225 MB of hotel review data and prepare it for a classifiation modeling. The end goal will be to read reviews and predict the overall rating a customer gives thier experience at the hotel.</p>

<h2 id="setting-up-this-notebook">Setting up this notebook</h2>
<p>I begin with with some core data science libraries Pandas and Numpy and will use the count vectorizer from SKlearn to breakdown the text of the reviews.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Import Libraries 
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span> <span class="c1"># dataframe manipulation 
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span> <span class="c1"># dependancy for pyplot
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span> <span class="c1"># create visualizations
</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span> <span class="c1"># prepare data for modeling
</span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span> <span class="c1"># process text data
</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Read in data
</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/Hotel_Reviews.csv'</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="exploritory-data-analyis">Exploritory Data Analyis</h1>

<h3 id="data-dictionary">Data Dictionary</h3>

<p>Each row is a hotel guest review of a stay along with some infromation about the hotel and the reviewer. The review is broken up with a positive and negative component and labled with tags that apply to the hotel stay being reviewed. Each review is stored alongside metadata and aggrgate metrics for both the hotel and reviewer. It appears each time a review is added mupltiple database records must be updated.</p>

<p><strong>Hotel data</strong></p>
<ul>
  <li>Hotel_Address - Property Address / business address</li>
  <li>Average_Score - Composite score for the hotel</li>
  <li>Hotel_Name - Property address/ business name</li>
  <li>Total_Number_of_Reviews - number of reviews completed by guests</li>
  <li>lat - latitude coodrinate</li>
  <li>lng - longitude coordinte</li>
</ul>

<p><strong>Review specific data</strong></p>
<ul>
  <li>Review_Date - date of feedback</li>
  <li>Negative_Review - text of negative portion of review</li>
  <li>Review_Total_Negative_Word_Counts - number of words in negative review</li>
  <li>Positive_Review - text of positive portion of review</li>
  <li>Review_Total_Positive_Word_Counts - number of words in positive review</li>
  <li>Reviewer_Score - the single number score a reviewer gives the hotel</li>
  <li>Tags - list features that apply to the stay being reviewed</li>
</ul>

<p><strong>Reviewer Data</strong></p>
<ul>
  <li>Reviewer_Nationality - Country of orgin of guest</li>
  <li>Total_Number_of_Reviews_Reviewer_Has_Given’ - number of reviews the guest has given</li>
  <li>days_since_review - the time passed since the guests most recent review</li>
</ul>

<p><strong>Other Data</strong></p>
<ul>
  <li>Additional_Number_of_Scoring - It is not clear what this number represents. I suspect that this is a weighting factor that affects the average score calculation.</li>
</ul>

<h3 id="the-data">The Data</h3>

<p>Reading the data and looking at a few of it’s top level properties I can see there are over half a million reviews. There is some cleaning that needs to happening before I get to modeling though. There a a few columns date or number columns stored as text as well as some missing location information.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Read in data
</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/Hotel_Reviews.csv'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'The data constains </span><span class="si">{</span><span class="n">raw_data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> rows and </span><span class="si">{</span><span class="n">raw_data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s"> columns.'</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">raw_data</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">raw_data</span><span class="p">.</span><span class="n">info</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">raw_data</span><span class="p">.</span><span class="n">describe</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The data constains 515738 rows and 17 columns.
</code></pre></div></div>

<!-- <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Hotel_Address</th>
      <th>Additional_Number_of_Scoring</th>
      <th>Review_Date</th>
      <th>Average_Score</th>
      <th>Hotel_Name</th>
      <th>Reviewer_Nationality</th>
      <th>Negative_Review</th>
      <th>Review_Total_Negative_Word_Counts</th>
      <th>Total_Number_of_Reviews</th>
      <th>Positive_Review</th>
      <th>Review_Total_Positive_Word_Counts</th>
      <th>Total_Number_of_Reviews_Reviewer_Has_Given</th>
      <th>Reviewer_Score</th>
      <th>Tags</th>
      <th>days_since_review</th>
      <th>lat</th>
      <th>lng</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>s Gravesandestraat 55 Oost 1092 AA Amsterdam ...</td>
      <td>194</td>
      <td>8/3/2017</td>
      <td>7.7</td>
      <td>Hotel Arena</td>
      <td>Russia</td>
      <td>I am so angry that i made this post available...</td>
      <td>397</td>
      <td>1403</td>
      <td>Only the park outside of the hotel was beauti...</td>
      <td>11</td>
      <td>7</td>
      <td>2.9</td>
      <td>[' Leisure trip ', ' Couple ', ' Duplex Double...</td>
      <td>0 days</td>
      <td>52.360576</td>
      <td>4.915968</td>
    </tr>
    <tr>
      <th>1</th>
      <td>s Gravesandestraat 55 Oost 1092 AA Amsterdam ...</td>
      <td>194</td>
      <td>8/3/2017</td>
      <td>7.7</td>
      <td>Hotel Arena</td>
      <td>Ireland</td>
      <td>No Negative</td>
      <td>0</td>
      <td>1403</td>
      <td>No real complaints the hotel was great great ...</td>
      <td>105</td>
      <td>7</td>
      <td>7.5</td>
      <td>[' Leisure trip ', ' Couple ', ' Duplex Double...</td>
      <td>0 days</td>
      <td>52.360576</td>
      <td>4.915968</td>
    </tr>
    <tr>
      <th>2</th>
      <td>s Gravesandestraat 55 Oost 1092 AA Amsterdam ...</td>
      <td>194</td>
      <td>7/31/2017</td>
      <td>7.7</td>
      <td>Hotel Arena</td>
      <td>Australia</td>
      <td>Rooms are nice but for elderly a bit difficul...</td>
      <td>42</td>
      <td>1403</td>
      <td>Location was good and staff were ok It is cut...</td>
      <td>21</td>
      <td>9</td>
      <td>7.1</td>
      <td>[' Leisure trip ', ' Family with young childre...</td>
      <td>3 days</td>
      <td>52.360576</td>
      <td>4.915968</td>
    </tr>
    <tr>
      <th>3</th>
      <td>s Gravesandestraat 55 Oost 1092 AA Amsterdam ...</td>
      <td>194</td>
      <td>7/31/2017</td>
      <td>7.7</td>
      <td>Hotel Arena</td>
      <td>United Kingdom</td>
      <td>My room was dirty and I was afraid to walk ba...</td>
      <td>210</td>
      <td>1403</td>
      <td>Great location in nice surroundings the bar a...</td>
      <td>26</td>
      <td>1</td>
      <td>3.8</td>
      <td>[' Leisure trip ', ' Solo traveler ', ' Duplex...</td>
      <td>3 days</td>
      <td>52.360576</td>
      <td>4.915968</td>
    </tr>
    <tr>
      <th>4</th>
      <td>s Gravesandestraat 55 Oost 1092 AA Amsterdam ...</td>
      <td>194</td>
      <td>7/24/2017</td>
      <td>7.7</td>
      <td>Hotel Arena</td>
      <td>New Zealand</td>
      <td>You When I booked with your company on line y...</td>
      <td>140</td>
      <td>1403</td>
      <td>Amazing location and building Romantic setting</td>
      <td>8</td>
      <td>3</td>
      <td>6.7</td>
      <td>[' Leisure trip ', ' Couple ', ' Suite ', ' St...</td>
      <td>10 days</td>
      <td>52.360576</td>
      <td>4.915968</td>
    </tr>
  </tbody>
</table>
</div> -->

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 515738 entries, 0 to 515737
Data columns (total 17 columns):
 #   Column                                      Non-Null Count   Dtype  
---  ------                                      --------------   -----  
 0   Hotel_Address                               515738 non-null  object 
 1   Additional_Number_of_Scoring                515738 non-null  int64  
 2   Review_Date                                 515738 non-null  object 
 3   Average_Score                               515738 non-null  float64
 4   Hotel_Name                                  515738 non-null  object 
 5   Reviewer_Nationality                        515738 non-null  object 
 6   Negative_Review                             515738 non-null  object 
 7   Review_Total_Negative_Word_Counts           515738 non-null  int64  
 8   Total_Number_of_Reviews                     515738 non-null  int64  
 9   Positive_Review                             515738 non-null  object 
 10  Review_Total_Positive_Word_Counts           515738 non-null  int64  
 11  Total_Number_of_Reviews_Reviewer_Has_Given  515738 non-null  int64  
 12  Reviewer_Score                              515738 non-null  float64
 13  Tags                                        515738 non-null  object 
 14  days_since_review                           515738 non-null  object 
 15  lat                                         512470 non-null  float64
 16  lng                                         512470 non-null  float64
dtypes: float64(4), int64(5), object(8)
memory usage: 66.9+ MB



None
</code></pre></div></div>

<!-- <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<!-- <table border="1" class="dataframe" style="width:10%">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Additional_Number_of_Scoring</th>
      <th>Average_Score</th>
      <th>Review_Total_Negative_Word_Counts</th>
      <th>Total_Number_of_Reviews</th>
      <th>Review_Total_Positive_Word_Counts</th>
      <th>Total_Number_of_Reviews_Reviewer_Has_Given</th>
      <th>Reviewer_Score</th>
      <th>lat</th>
      <th>lng</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>515738.000000</td>
      <td>515738.000000</td>
      <td>515738.000000</td>
      <td>515738.000000</td>
      <td>515738.000000</td>
      <td>515738.000000</td>
      <td>515738.000000</td>
      <td>512470.000000</td>
      <td>512470.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>498.081836</td>
      <td>8.397487</td>
      <td>18.539450</td>
      <td>2743.743944</td>
      <td>17.776458</td>
      <td>7.166001</td>
      <td>8.395077</td>
      <td>49.442439</td>
      <td>2.823803</td>
    </tr>
    <tr>
      <th>std</th>
      <td>500.538467</td>
      <td>0.548048</td>
      <td>29.690831</td>
      <td>2317.464868</td>
      <td>21.804185</td>
      <td>11.040228</td>
      <td>1.637856</td>
      <td>3.466325</td>
      <td>4.579425</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>5.200000</td>
      <td>0.000000</td>
      <td>43.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2.500000</td>
      <td>41.328376</td>
      <td>-0.369758</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>169.000000</td>
      <td>8.100000</td>
      <td>2.000000</td>
      <td>1161.000000</td>
      <td>5.000000</td>
      <td>1.000000</td>
      <td>7.500000</td>
      <td>48.214662</td>
      <td>-0.143372</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>341.000000</td>
      <td>8.400000</td>
      <td>9.000000</td>
      <td>2134.000000</td>
      <td>11.000000</td>
      <td>3.000000</td>
      <td>8.800000</td>
      <td>51.499981</td>
      <td>0.010607</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>660.000000</td>
      <td>8.800000</td>
      <td>23.000000</td>
      <td>3613.000000</td>
      <td>22.000000</td>
      <td>8.000000</td>
      <td>9.600000</td>
      <td>51.516288</td>
      <td>4.834443</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2682.000000</td>
      <td>9.800000</td>
      <td>408.000000</td>
      <td>16670.000000</td>
      <td>395.000000</td>
      <td>355.000000</td>
      <td>10.000000</td>
      <td>52.400181</td>
      <td>16.429233</td>
    </tr>
  </tbody>
</table>
</div> -->

<h3 id="numeric-property-distibutions">Numeric Property Distibutions</h3>

<p>Insights</p>
<ul>
  <li>Word counts distibution for positive and negative reviews are similar</li>
  <li>Additital Number of Scoring has a smiliar distribution shape as the total number of a reviews. Perhaps the total number of reviews is tied to addtional scoring</li>
  <li>The distibution of Reviewer Score and average score do not match. This seems suprising at first, but considering that the average score is always made up of a collection of individual scores the almost normal distribution of the average score makes sense.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="p">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s">'object'</span><span class="p">).</span><span class="n">columns</span><span class="p">:</span>
    
    <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s">'EDA: </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span><span class="mi">1</span>

<span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div></div>

<p><img src="/Kibat_NLP_PART_1_files/Kibat_NLP_PART_1_9_0.png" alt="png" /></p>

<h3 id="data-cleaning">Data Cleaning</h3>
<p>Guests can leave a 1-10 score for each visit, but after the aggregation I’m left with decimalized ratings. I’m going to simplify the scores by rounding them to integers.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Rating categories in raw data </span><span class="si">{</span><span class="n">raw_data</span><span class="p">[</span><span class="s">"Reviewer_Score"</span><span class="p">].</span><span class="n">value_counts</span><span class="p">().</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="c1"># Round each review score and then save in a new colums as an integer
</span><span class="n">raw_data</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="s">'Reviewer_Score'</span><span class="p">]).</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Look at the results
</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Rating categories after rounding </span><span class="si">{</span><span class="n">raw_data</span><span class="p">[</span><span class="s">"Rating Int"</span><span class="p">].</span><span class="n">value_counts</span><span class="p">().</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">].</span><span class="n">value_counts</span><span class="p">())</span>

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Rating categories in raw data 37
Rating categories after rounding 9
10    187744
8     110155
9     105722
7      44088
6      27800
5      24188
4       9436
3       4406
2       2199
Name: Rating Int, dtype: int64
</code></pre></div></div>

<p>Generally data is expected to follow a normal distibution. In the case of reviews this is should not be exected since the motivation to leave a review may come an outlier experience. Given this I would expect to see reviews clustered around the high and low end of the scale.</p>

<p>The actual distibution shows the reviews are tend to be on the higher side of the scale with ratings of 8 - 10.</p>

<p>This raises issues since any model we train will be biased toward a higher rating because our sample population consists of higher ratings. The model will have more information about what makes a good review than what makes a bad review.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#plot the distibution of ratings
</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Distribution of Review Score'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Score'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Frequency'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/Kibat_NLP_PART_1_files/Kibat_NLP_PART_1_13_0.png" alt="png" /></p>

<p>Here is the breakdown of numeric and non numeric fields. <code class="language-plaintext highlighter-rouge">days_since_review</code> and <code class="language-plaintext highlighter-rouge">Review_date</code> can easily be changed to numeric columns. <code class="language-plaintext highlighter-rouge">Reviewer_Nationality</code> could be converted using a one hot encoding. <code class="language-plaintext highlighter-rouge">Tags</code>, <code class="language-plaintext highlighter-rouge">Positive_Review</code> and <code class="language-plaintext highlighter-rouge">Negative_Review</code> could be coverted using count vecortizors.</p>

<p><strong>Numeric</strong></p>
<ul>
  <li>Additional_Number_of_Scoring</li>
  <li>Average_Score</li>
  <li>Review_Total_Negative_Word_Counts</li>
  <li>Total_Number_of_Reviews</li>
  <li>Review_Total_Positive_Word_Counts</li>
  <li>Total_Number_of_Reviews_Reviewer_Has_Given</li>
  <li>Reviewer_Score</li>
  <li>lat</li>
  <li>lng</li>
  <li>Rating Int</li>
</ul>

<p><strong>Non-numeric</strong></p>
<ul>
  <li>Hotel_Address</li>
  <li>Review_Date</li>
  <li>Hotel_Name</li>
  <li>Reviewer_Nationality</li>
  <li>Negative_Review</li>
  <li>Positive_Review</li>
  <li>Tags</li>
  <li>days_since_review</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Look at the number of countries represented 
</span><span class="n">raw_data</span><span class="p">[</span><span class="s">'Reviewer_Nationality'</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> United Kingdom               245246
 United States of America      35437
 Australia                     21686
 Ireland                       14827
 United Arab Emirates          10235
                               ...  
 Cape Verde                        1
 Northern Mariana Islands          1
 Tuvalu                            1
 Guinea                            1
 Palau                             1
Name: Reviewer_Nationality, Length: 227, dtype: int64
</code></pre></div></div>

<p>To make this practice easier on my laptop’s CPU I’m going to sample the dataset. I sample the data and then verfiy the mix of my target classes matches between the orginal and sample set.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># create a new dataframe that is a sample of the entire data set
</span><span class="n">smaller_df</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="c1">## reindex the new dataframe
</span><span class="n">smaller_df</span> <span class="o">=</span> <span class="n">smaller_df</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1">#check the shapes to confrim a success 
</span><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Orginal data shape</span><span class="si">{</span><span class="n">raw_data</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Sampled data shape </span><span class="si">{</span><span class="n">smaller_df</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'The sample dataframe has </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">smaller_df</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">raw_data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s">% of the rows as the original df.'</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Orginal data shape(515738, 18)
Sampled data shape (51574, 18)
The sample dataframe has 10.0% of the rows as the original df.
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Confrim proprtionate class representation between the orginal and new dataframes
</span>
<span class="c1"># Create a df to store the class mixes
</span><span class="n">validation_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># calculate the class mixes and add them to the new df
</span><span class="n">validation_df</span><span class="p">[</span><span class="s">'Raw mix'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">raw_data</span><span class="p">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s">'Rating Int'</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">validation_df</span><span class="p">[</span><span class="s">'sample mix'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">smaller_df</span><span class="p">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s">'Rating Int'</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># show the new df
</span><span class="n">validation_df</span><span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">])</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Raw mix</th>
      <th>sample mix</th>
    </tr>
    <tr>
      <th>Rating Int</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>9.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>21.0</td>
      <td>22.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>20.0</td>
      <td>21.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>36.0</td>
      <td>36.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>The unusual distibution of the review score will make modeling difficult. With the distibuation skewing toward the high and low end of the scale I can simplify that rating further into a good/bad classification. This leaves me with a dataset evenly distibuted between the two classes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a list of good scores
</span><span class="n">good_scores</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>

<span class="c1"># replace ratings with a binary 
</span><span class="n">smaller_df</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">smaller_df</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">].</span><span class="n">isin</span><span class="p">(</span><span class="n">good_scores</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># look at the breakdown
</span><span class="n">smaller_df</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1    29299
0    22275
Name: Rating Int, dtype: int64
</code></pre></div></div>

<p>Earlier it was noted <code class="language-plaintext highlighter-rouge">days_since_review</code> and <code class="language-plaintext highlighter-rouge">Review_date</code> can easily be changed to numeric columns. <code class="language-plaintext highlighter-rouge">Reviewer_Nationality</code> and  <code class="language-plaintext highlighter-rouge">Tags</code> could be transfromed as well. Using nationality as a predicitve feature is something that could add bias to the model. <code class="language-plaintext highlighter-rouge">Tags</code> seem to be more helpful in finding reviews on a certain topic than saying anything about the qaulity of the experience. As they are more descriptive than predeictive they will be dropped and the focus for classification will be on the review text.</p>

<p><code class="language-plaintext highlighter-rouge">days_since_review</code> has a number along with the word ‘day’ or ‘days’ with it. This can easily converted using <code class="language-plaintext highlighter-rouge">srt.split</code>.</p>

<p><code class="language-plaintext highlighter-rouge">Review date</code> can be coverted using date and time features of pandas.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## remove separate the number and text in the `days_since_review` columns and store the number chars as int
</span>
<span class="n">smaller_df</span><span class="p">[</span><span class="s">'days_since_review'</span><span class="p">]</span> <span class="o">=</span> <span class="n">smaller_df</span><span class="p">[</span><span class="s">'days_since_review'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">).</span><span class="nb">str</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="s">'int'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Look at the results
</span><span class="n">smaller_df</span><span class="p">[</span><span class="s">'days_since_review'</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>120    243
1      243
322    225
338    203
534    196
      ... 
122     16
615     16
124     15
121     13
123     12
Name: days_since_review, Length: 731, dtype: int64
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## convert the dates since last review to a dat time columns
</span>
<span class="n">smaller_df</span><span class="p">[</span><span class="s">'Review_Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">smaller_df</span><span class="p">[</span><span class="s">'Review_Date'</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Look at the results
</span>
<span class="n">smaller_df</span><span class="p">[</span><span class="s">'Review_Date'</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0   2017-02-17
1   2016-02-16
2   2016-07-09
3   2015-12-07
4   2017-05-14
Name: Review_Date, dtype: datetime64[ns]
</code></pre></div></div>

<p>Now, I can drop the other columns that I won’t use in modeling. I’m saving the reviews to breakdown next.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## drop other object columns
</span>
<span class="c1"># get a list of object cols
</span><span class="n">object_cols_to_drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">smaller_df</span><span class="p">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s">'object'</span><span class="p">).</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># remove the cols I want to keep
</span><span class="n">object_cols_to_drop</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'Negative_Review'</span><span class="p">)</span>
<span class="n">object_cols_to_drop</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'Positive_Review'</span><span class="p">)</span>

<span class="c1"># drop the remaining object cols
</span><span class="n">smaller_df</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">object_cols_to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># look at the remaining columns
</span>
<span class="n">smaller_df</span><span class="p">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 51574 entries, 0 to 51573
Data columns (total 14 columns):
 #   Column                                      Non-Null Count  Dtype         
---  ------                                      --------------  -----         
 0   Additional_Number_of_Scoring                51574 non-null  int64         
 1   Review_Date                                 51574 non-null  datetime64[ns]
 2   Average_Score                               51574 non-null  float64       
 3   Negative_Review                             51574 non-null  object        
 4   Review_Total_Negative_Word_Counts           51574 non-null  int64         
 5   Total_Number_of_Reviews                     51574 non-null  int64         
 6   Positive_Review                             51574 non-null  object        
 7   Review_Total_Positive_Word_Counts           51574 non-null  int64         
 8   Total_Number_of_Reviews_Reviewer_Has_Given  51574 non-null  int64         
 9   Reviewer_Score                              51574 non-null  float64       
 10  days_since_review                           51574 non-null  int32         
 11  lat                                         51244 non-null  float64       
 12  lng                                         51244 non-null  float64       
 13  Rating Int                                  51574 non-null  int32         
dtypes: datetime64[ns](1), float64(4), int32(2), int64(5), object(2)
memory usage: 5.1+ MB
</code></pre></div></div>

<p>Spliting the dataset into test and training sets in important when modeling. It provides an opportunity to look evaluate the perfromance of the model against labeled data it has not yet encountered.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Separate the target column from the data column
</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">smaller_df</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'Rating Int'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">smaller_df</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">]</span>

<span class="c1">#set up the test and train sets
</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="vectorization">Vectorization</h2>

<p>Since the data has punctuation already removed the tokenization step of vecotorization is not needed. It is still helpful to remove the stopwords and set the <code class="language-plaintext highlighter-rouge">min_df</code> parameter. <code class="language-plaintext highlighter-rouge">min_df</code> is the parameter that determines the theshold for including a string in the bag of words. Strings that appear in fewer than the parameter speficies are excluded from the bag. This parameter was adjusted until both positive and negative reviews yielded 10 words.</p>

<p>Once the feature words are selected and a sparse matix was formed for each, they were added to the main datafrme. The last step was to remove duplicate columns. In this case duplicate columns are those words that apppeared in both postive reviews and negative reviews. These words being ambiguious will not add anything of value to the model.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># Create the bag of words for positive reviews
</span><span class="n">positive_bagofwords</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">min_df</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="s">'english'</span><span class="p">)</span>
<span class="n">positive_bagofwords</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s">'Positive_Review'</span><span class="p">])</span>

<span class="c1"># transfrom the bag of words to a sparse matrix
</span><span class="n">positive_bagofwords_transfromed</span> <span class="o">=</span> <span class="n">positive_bagofwords</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s">'Positive_Review'</span><span class="p">])</span>

<span class="c1">#Count the number of words the bag of words categorized
</span>
<span class="nb">len</span><span class="p">(</span><span class="n">positive_bagofwords</span><span class="p">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1805
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a user friendly df from the bag of words and tag them as positive
</span><span class="n">positive_sparse_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">positive_bagofwords</span><span class="p">.</span><span class="n">get_feature_names_out</span><span class="p">(),</span> <span class="n">data</span><span class="o">=</span><span class="n">positive_bagofwords_transfromed</span><span class="p">.</span><span class="n">toarray</span><span class="p">()).</span><span class="n">add_prefix</span><span class="p">(</span><span class="s">'p_'</span><span class="p">,)</span>
<span class="n">display</span><span class="p">(</span><span class="n">positive_sparse_df</span><span class="p">)</span>
</code></pre></div></div>

<!-- <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p_00</th>
      <th>p_02</th>
      <th>p_10</th>
      <th>p_100</th>
      <th>p_100m</th>
      <th>p_10min</th>
      <th>p_10th</th>
      <th>p_11</th>
      <th>p_12</th>
      <th>p_13</th>
      <th>...</th>
      <th>p_wouldn</th>
      <th>p_wow</th>
      <th>p_wrong</th>
      <th>p_yards</th>
      <th>p_year</th>
      <th>p_years</th>
      <th>p_yes</th>
      <th>p_yogurt</th>
      <th>p_young</th>
      <th>p_yummy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>41254</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41255</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41256</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41257</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41258</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>41259 rows × 1805 columns</p>
</div> -->

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#create a sprase matrix for the negative reviews
</span>
<span class="n">negative_bagofwords</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">min_df</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="s">'english'</span><span class="p">)</span>
<span class="n">negative_bagofwords</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s">'Negative_Review'</span><span class="p">])</span>

<span class="c1"># transfrom the bag of words to a sparse matrix
</span><span class="n">negative_bagofwords_transfromed</span> <span class="o">=</span> <span class="n">negative_bagofwords</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s">'Negative_Review'</span><span class="p">])</span>

<span class="c1">#Count the number of words the bag of words categorized
</span><span class="nb">len</span><span class="p">(</span><span class="n">negative_bagofwords</span><span class="p">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1640
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a user friendly df from the bag of words
</span><span class="n">negative_sparse_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">negative_bagofwords</span><span class="p">.</span><span class="n">get_feature_names_out</span><span class="p">(),</span> <span class="n">data</span><span class="o">=</span><span class="n">negative_bagofwords_transfromed</span><span class="p">.</span><span class="n">toarray</span><span class="p">()).</span><span class="n">add_prefix</span><span class="p">(</span><span class="s">'n_'</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">negative_sparse_df</span><span class="p">)</span>
</code></pre></div></div>

<!-- <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_00</th>
      <th>n_10</th>
      <th>n_100</th>
      <th>n_10pm</th>
      <th>n_11</th>
      <th>n_11pm</th>
      <th>n_12</th>
      <th>n_13</th>
      <th>n_14</th>
      <th>n_15</th>
      <th>...</th>
      <th>n_worth</th>
      <th>n_wouldn</th>
      <th>n_write</th>
      <th>n_written</th>
      <th>n_wrong</th>
      <th>n_year</th>
      <th>n_years</th>
      <th>n_yes</th>
      <th>n_young</th>
      <th>n_zero</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>41254</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41255</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41256</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41257</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41258</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>41259 rows × 1640 columns</p>
</div> -->

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># look at the lists of words chosen 
</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Negative bag of words </span><span class="si">{</span><span class="n">negative_bagofwords</span><span class="p">.</span><span class="n">get_feature_names_out</span><span class="p">()</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Positive bag of words </span><span class="si">{</span><span class="n">positive_bagofwords</span><span class="p">.</span><span class="n">get_feature_names_out</span><span class="p">()</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Negative bag of words ['00' '10' '100' ... 'yes' 'young' 'zero']
Positive bag of words ['00' '02' '10' ... 'yogurt' 'young' 'yummy']
</code></pre></div></div>

<p>Now that I have the useful columns isolated and both of the review columns broken down into sparse matrices I can create a datafame ready for machine learning modeling.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># combine the three dataframes
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">smaller_df</span><span class="p">,</span><span class="n">positive_sparse_df</span><span class="p">,</span> <span class="n">negative_sparse_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Look for duplicate columns
</span><span class="n">duplicate_col</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">duplicated</span><span class="p">()]</span>
<span class="k">print</span><span class="p">(</span><span class="n">duplicate_col</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Index([], dtype='object')
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(51574, 3459)
</code></pre></div></div>

<p>With this process complete I will follow up with another post following the process I used to model this data and compare a few different modeling methods.</p>

  </div>

  <div class="date">
    Written on January  5, 2022
  </div>

  
</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:russkibat@pm.me"><i class="svg-icon email"></i></a>


<a href="https://github.com/www.github.com/russ-kibat"><i class="svg-icon github"></i></a>

<a href="https://www.linkedin.com/in/www.linkediin.com/russkibat"><i class="svg-icon linkedin"></i></a>






        </footer>
      </div>
    </div>

    

  </body>
</html>
