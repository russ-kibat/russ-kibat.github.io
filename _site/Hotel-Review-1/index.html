<!DOCTYPE html>
<html>
  <head>
    <title>Hotel Review Analysis Using NLP Part 1 – Russ Kibat – Data Scientist</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Background
Customer reviews are vital in understanding how a company can focus its attention on maintaining and growing its customer base. This is especially important in the hospitality industry where customers’ brand loyalty relies on consistent, positive experiences for frequent travelers. Text data is time consuming to process and it can be difficult to get an understanding of subtle trends in the data without cross checking reviews to see if keywords are predictive of an overall rating. To aid this effort I am going to analyze customer feedback from an internationally operating hotel company. My goal is to build a model that can predict an overall positive or negative rating, based on common keywords in reviews. Once a reliable model has been developed I can deliver the keywords to company management responsible for improving customer experience. These insights will inform them as to what the hotels are doing well and where they can improve.
" />
    <meta property="og:description" content="Background
Customer reviews are vital in understanding how a company can focus its attention on maintaining and growing its customer base. This is especially important in the hospitality industry where customers’ brand loyalty relies on consistent, positive experiences for frequent travelers. Text data is time consuming to process and it can be difficult to get an understanding of subtle trends in the data without cross checking reviews to see if keywords are predictive of an overall rating. To aid this effort I am going to analyze customer feedback from an internationally operating hotel company. My goal is to build a model that can predict an overall positive or negative rating, based on common keywords in reviews. Once a reliable model has been developed I can deliver the keywords to company management responsible for improving customer experience. These insights will inform them as to what the hotels are doing well and where they can improve.
" />
    
    <meta name="author" content="Russ Kibat" />

    
    <meta property="og:title" content="Hotel Review Analysis Using NLP Part 1" />
    <meta property="twitter:title" content="Hotel Review Analysis Using NLP Part 1" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Russ Kibat - Data Scientist" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://raw.githubusercontent.com/russ-kibat/russ-kibat.github.io/master/images/profile_picture.jpg" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Russ Kibat</a></h1>
            <p class="site-description">Data Scientist</p>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>Hotel Review Analysis Using NLP Part 1</h1>

  <div class="entry">
    <h2 id="background">Background</h2>
<p>Customer reviews are vital in understanding how a company can focus its attention on maintaining and growing its customer base. This is especially important in the hospitality industry where customers’ brand loyalty relies on consistent, positive experiences for frequent travelers. Text data is time consuming to process and it can be difficult to get an understanding of subtle trends in the data without cross checking reviews to see if keywords are predictive of an overall rating. To aid this effort I am going to analyze customer feedback from an internationally operating hotel company. My goal is to build a model that can predict an overall positive or negative rating, based on common keywords in reviews. Once a reliable model has been developed I can deliver the keywords to company management responsible for improving customer experience. These insights will inform them as to what the hotels are doing well and where they can improve.</p>

<p>In this post I am going to explore and clean the dataset in preparation for modeling. I use <code class="language-plaintext highlighter-rouge">Pandas</code> and <code class="language-plaintext highlighter-rouge">Matplotlib</code> to explore the data and clean up issues. I also use <code class="language-plaintext highlighter-rouge">SKLearn.feature_extraction.CountVectorizer</code> to parse the text reviews and add sparse matrices to the core data. In the follow up post I will compare several machine learning models to predict a positive or negative customer review based on their feedback and extract the relevant keywords for positive and negative reviews.</p>

<p>The repository for this project can be found on my
<a href="https://github.com/russ-kibat/Hotel-Reviews">Github</a>.</p>

<hr />

<h2 id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<p>To get started I need to import the standard data science libraries and read the data into memory.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Import Libraries 
# Data wrangling 
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span> <span class="c1"># dataframe manipulation 
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span> <span class="c1"># dependency  for pyplot
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span> <span class="c1"># create visualizations
</span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span> <span class="c1"># Data sampling
</span>
<span class="c1"># Text parsing 
</span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span> <span class="c1"># process text data
</span>
<span class="c1"># Read in data
</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/Hotel_Reviews.csv'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Read in data
</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/Hotel_Reviews.csv'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="data-dictionary">Data Dictionary</h3>

<p>Each row is a hotel guest review of a stay along with some information about the hotel and the reviewer. The review is broken up with a positive and negative component and labeled with tags that apply to the hotel stay being reviewed. Each review is stored alongside metadata and aggregate metrics for both the hotel and reviewer. It appears each time a review is added multiple database records must be updated.</p>

<p><strong>Hotel data</strong></p>
<ul>
  <li>Hotel_Address - Property address</li>
  <li>Average_Score - Composite score for the hotel</li>
  <li>Hotel_Name - Property address</li>
  <li>Total_Number_of_Reviews - Count of reviews per hotel</li>
  <li>lat - Latitude coordinate</li>
  <li>lng - Longitude coordinate</li>
</ul>

<p><strong>Review specific data</strong></p>
<ul>
  <li>Review_Date - Date of review</li>
  <li>Negative_Review - Text of negative portion of review</li>
  <li>Review_Total_Negative_Word_Counts - Number of words in negative review</li>
  <li>Positive_Review - Text of positive portion of review</li>
  <li>Review_Total_Positive_Word_Counts - Number of words in positive review</li>
  <li>Reviewer_Score - The single number score a reviewer gives the hotel</li>
  <li>Tags - List features that apply to the stay being reviewed</li>
</ul>

<p><strong>Reviewer Data</strong></p>
<ul>
  <li>Reviewer_Nationality - Country of origin of guest</li>
  <li>Total_Number_of_Reviews_Reviewer_Has_Given’ - Number of reviews the guest has given</li>
  <li>Days_since_review - The time passed since the guests most recent review</li>
</ul>

<p><strong>Other Data</strong></p>
<ul>
  <li>Additional_Number_of_Scoring - Total number of reviews for a hotel</li>
</ul>

<p>I want to take a peek into the data to get a feel for what it contains and the shape of the file. There are over half a million reviews and the columns do match the description in the data dictionary. It’s very helpful there are designated positive and negative reviews. It will be interesting to see words that appear on both sides. That may provide insight to things that can sway a guest’s experience rather than things that should be added or removed from the experiences.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># show the number of rows and columns in the data
</span><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'The data constains </span><span class="si">{</span><span class="n">raw_data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> rows and </span><span class="si">{</span><span class="n">raw_data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s"> columns.'</span><span class="p">)</span>

<span class="c1"># show a row of the data
# instead of df.head(), pick single row and transpose it for the reader
</span><span class="n">display</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">].</span><span class="n">T</span><span class="p">.</span><span class="n">style</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The data constains 515738 rows and 17 columns.
</code></pre></div></div>

<style type="text/css">
</style>

<table id="T_facd0">
  <thead>
    <tr>
      <th class="blank level0">&nbsp;</th>
      <th id="T_facd0_level0_col0" class="col_heading level0 col0">2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_facd0_level0_row0" class="row_heading level0 row0">Hotel_Address</th>
      <td id="T_facd0_row0_col0" class="data row0 col0"> s Gravesandestraat 55 Oost 1092 AA Amsterdam Netherlands</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row1" class="row_heading level0 row1">Additional_Number_of_Scoring</th>
      <td id="T_facd0_row1_col0" class="data row1 col0">194</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row2" class="row_heading level0 row2">Review_Date</th>
      <td id="T_facd0_row2_col0" class="data row2 col0">7/31/2017</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row3" class="row_heading level0 row3">Average_Score</th>
      <td id="T_facd0_row3_col0" class="data row3 col0">7.700000</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row4" class="row_heading level0 row4">Hotel_Name</th>
      <td id="T_facd0_row4_col0" class="data row4 col0">Hotel Arena</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row5" class="row_heading level0 row5">Reviewer_Nationality</th>
      <td id="T_facd0_row5_col0" class="data row5 col0"> Australia </td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row6" class="row_heading level0 row6">Negative_Review</th>
      <td id="T_facd0_row6_col0" class="data row6 col0"> Rooms are nice but for elderly a bit difficult as most rooms are two story with narrow steps So ask for single level Inside the rooms are very very basic just tea coffee and boiler and no bar empty fridge </td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row7" class="row_heading level0 row7">Review_Total_Negative_Word_Counts</th>
      <td id="T_facd0_row7_col0" class="data row7 col0">42</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row8" class="row_heading level0 row8">Total_Number_of_Reviews</th>
      <td id="T_facd0_row8_col0" class="data row8 col0">1403</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row9" class="row_heading level0 row9">Positive_Review</th>
      <td id="T_facd0_row9_col0" class="data row9 col0"> Location was good and staff were ok It is cute hotel the breakfast range is nice Will go back </td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row10" class="row_heading level0 row10">Review_Total_Positive_Word_Counts</th>
      <td id="T_facd0_row10_col0" class="data row10 col0">21</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row11" class="row_heading level0 row11">Total_Number_of_Reviews_Reviewer_Has_Given</th>
      <td id="T_facd0_row11_col0" class="data row11 col0">9</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row12" class="row_heading level0 row12">Reviewer_Score</th>
      <td id="T_facd0_row12_col0" class="data row12 col0">7.100000</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row13" class="row_heading level0 row13">Tags</th>
      <td id="T_facd0_row13_col0" class="data row13 col0">[' Leisure trip ', ' Family with young children ', ' Duplex Double Room ', ' Stayed 3 nights ', ' Submitted from a mobile device ']</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row14" class="row_heading level0 row14">days_since_review</th>
      <td id="T_facd0_row14_col0" class="data row14 col0">3 days</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row15" class="row_heading level0 row15">lat</th>
      <td id="T_facd0_row15_col0" class="data row15 col0">52.360576</td>
    </tr>
    <tr>
      <th id="T_facd0_level0_row16" class="row_heading level0 row16">lng</th>
      <td id="T_facd0_row16_col0" class="data row16 col0">4.915968</td>
    </tr>
  </tbody>
</table>

<h3 id="data-cleaning">Data Cleaning</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># look at the value counts and datatypes
</span><span class="n">raw_data</span><span class="p">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 515738 entries, 0 to 515737
Data columns (total 17 columns):
 #   Column                                      Non-Null Count   Dtype  
---  ------                                      --------------   -----  
 0   Hotel_Address                               515738 non-null  object 
 1   Additional_Number_of_Scoring                515738 non-null  int64  
 2   Review_Date                                 515738 non-null  object 
 3   Average_Score                               515738 non-null  float64
 4   Hotel_Name                                  515738 non-null  object 
 5   Reviewer_Nationality                        515738 non-null  object 
 6   Negative_Review                             515738 non-null  object 
 7   Review_Total_Negative_Word_Counts           515738 non-null  int64  
 8   Total_Number_of_Reviews                     515738 non-null  int64  
 9   Positive_Review                             515738 non-null  object 
 10  Review_Total_Positive_Word_Counts           515738 non-null  int64  
 11  Total_Number_of_Reviews_Reviewer_Has_Given  515738 non-null  int64  
 12  Reviewer_Score                              515738 non-null  float64
 13  Tags                                        515738 non-null  object 
 14  days_since_review                           515738 non-null  object 
 15  lat                                         512470 non-null  float64
 16  lng                                         512470 non-null  float64
dtypes: float64(4), int64(5), object(8)
memory usage: 66.9+ MB
</code></pre></div></div>

<p>A couple things jump out when looking at this summary. First, I’m happy to see that most rows are complete. There are some missing coordinates for the location. Luckily, we have the hotel address so it will be possible to complete those rows. For now, I’m going to skip that and focus on fixing the data types. There are several that are stored as objects that would be useful for modeling if they were converted to numbers. <code class="language-plaintext highlighter-rouge">Review_Date</code> can be changed to a datetime type. Looking at my sample row above I can see that <code class="language-plaintext highlighter-rouge">days_since_review</code> can include “days”. I remove that string and change that column to an integer.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## convert the dates since last review to a datetime columns
</span><span class="n">raw_data</span><span class="p">[</span><span class="s">'Review_Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="s">'Review_Date'</span><span class="p">])</span>

<span class="c1"># remove separate the number and text in the `days_since_review`
# split the string at the first space and place the first value returned in its place as an int
</span><span class="n">raw_data</span><span class="p">[</span><span class="s">'days_since_review'</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s">'days_since_review'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">).</span><span class="nb">str</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="s">'int'</span><span class="p">)</span>


</code></pre></div></div>

<h2 id="feature-engineering">Feature Engineering</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create histograms of numeric columns
</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="c1"># plot a histogram for each column in the data, excluding non-numerics
</span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="p">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s">'object'</span><span class="p">).</span><span class="n">columns</span><span class="p">:</span>
    
    <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s">'Distribution: </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span><span class="mi">1</span>

<span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div></div>

<p><img src="/KIBAT_NLP_PART_1_files/KIBAT_NLP_PART_1_12_0.png" alt="png" /></p>

<p>With the data types fixed I can now look at the distributions of the numeric columns and see if there is anything that will be a problem in the dataset. The target of the model will be the <code class="language-plaintext highlighter-rouge">Reviewer_Score</code>. That column is heavily skewed to higher ratings and that imbalance will be a problem for the models. Since I am ultimately looking to predict a positive/negative outcome I can convert this to a binary if I count reviews 9.0 or more as positive and reviews less than 9 as negative. This conversion leaves me with a nearly 50/50 split of positive and negative reviews.</p>

<p>I ran into memory issues once I started working with the count vectorizer. To get around this I sampled 10% of the data and confirmed that the distribution of the target matched the original dataset.</p>

<p>I also take the chance to get rid of object columns the models will not be looking at. Of course, I leave the review columns to parse in the next section.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># replace ratings with a binary 
</span><span class="n">raw_data</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="s">'Reviewer_Score'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">9.0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># check the value counts of the new binary score. 
</span><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">raw_data</span><span class="p">[</span><span class="s">"Rating Int"</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">raw_data</span><span class="p">[</span><span class="s">"Rating Int"</span><span class="p">].</span><span class="n">value_counts</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s">% negative reviews</span><span class="se">\n</span><span class="si">{</span><span class="n">raw_data</span><span class="p">[</span><span class="s">"Rating Int"</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">raw_data</span><span class="p">[</span><span class="s">"Rating Int"</span><span class="p">].</span><span class="n">value_counts</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s">% positive reviews'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>52.10029123314551% negative reviews
47.89970876685449% positive reviews
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># create a new dataframe that is a sample of the entire data set
</span><span class="n">smaller_df</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="c1">## reindex the new dataframe
</span><span class="n">smaller_df</span> <span class="o">=</span> <span class="n">smaller_df</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1">#check the shapes to confirm a success 
</span><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Original data shape</span><span class="si">{</span><span class="n">raw_data</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Sampled data shape </span><span class="si">{</span><span class="n">smaller_df</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'The sample data frame has </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">smaller_df</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">raw_data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s">% of the rows as the original df.'</span><span class="p">)</span>

<span class="c1"># Confirm proportionate class representation between the original and new data frames
# Create a df to store the class mixes
</span><span class="n">validation_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># calculate the class mixes and add them to the new df
</span><span class="n">validation_df</span><span class="p">[</span><span class="s">'Raw mix'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">raw_data</span><span class="p">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s">'Rating Int'</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">validation_df</span><span class="p">[</span><span class="s">'sample mix'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">smaller_df</span><span class="p">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s">'Rating Int'</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># show the new df
</span><span class="n">display</span><span class="p">(</span><span class="n">validation_df</span><span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">]))</span>
<span class="c1">## drop other object columns
# get a list of object cols
</span><span class="n">object_cols_to_drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">smaller_df</span><span class="p">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s">'object'</span><span class="p">).</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># remove the cols I want to keep
</span><span class="n">object_cols_to_drop</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'Negative_Review'</span><span class="p">)</span>
<span class="n">object_cols_to_drop</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'Positive_Review'</span><span class="p">)</span>

<span class="c1"># drop the remaining object columns
</span><span class="n">clean_df</span><span class="o">=</span> <span class="n">smaller_df</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">object_cols_to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># look at the remaining columns
</span><span class="k">print</span><span class="p">(</span><span class="n">clean_df</span><span class="p">.</span><span class="n">info</span><span class="p">())</span>

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Original data shape(515738, 18)
Sampled data shape (51574, 18)
The sample data frame has 10.0% of the rows as the original df.
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Raw mix</th>
      <th>sample mix</th>
    </tr>
    <tr>
      <th>Rating Int</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>52.0</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48.0</td>
      <td>48.0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 51574 entries, 0 to 51573
Data columns (total 14 columns):
 #   Column                                      Non-Null Count  Dtype         
---  ------                                      --------------  -----         
 0   Additional_Number_of_Scoring                51574 non-null  int64         
 1   Review_Date                                 51574 non-null  datetime64[ns]
 2   Average_Score                               51574 non-null  float64       
 3   Negative_Review                             51574 non-null  object        
 4   Review_Total_Negative_Word_Counts           51574 non-null  int64         
 5   Total_Number_of_Reviews                     51574 non-null  int64         
 6   Positive_Review                             51574 non-null  object        
 7   Review_Total_Positive_Word_Counts           51574 non-null  int64         
 8   Total_Number_of_Reviews_Reviewer_Has_Given  51574 non-null  int64         
 9   Reviewer_Score                              51574 non-null  float64       
 10  days_since_review                           51574 non-null  int32         
 11  lat                                         51244 non-null  float64       
 12  lng                                         51244 non-null  float64       
 13  Rating Int                                  51574 non-null  int32         
dtypes: datetime64[ns](1), float64(4), int32(2), int64(5), object(2)
memory usage: 5.1+ MB
None
</code></pre></div></div>

<h3 id="count-vectorization">Count Vectorization</h3>

<p>In order to model the text reviews I need to represent them as numbers. I parse each word of each review and create sparse matrices of reviews in the review. SKLearn’s countvectorizer is the tool I use to accomplish this. Once the vectorizer is initialized and the object for the positive reviews is created it can be transformed into a sparse matrix. For each word in the reviews there is a column with the number of times it appears in the review. This is then turned into a Pandas friendly data frame and appended to the core data. At this point I save the datafile and am ready to model.</p>

<p>It’s important that I split my data into a test/train dataset before this process begins. In the process of the test reviews should not be included in training set vectorization to ensure the test reviews do not influence the model.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Separate the target column from the data column
</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">smaller_df</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'Rating Int'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">smaller_df</span><span class="p">[</span><span class="s">'Rating Int'</span><span class="p">]</span>

<span class="c1">#set up the test and train sets
</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># Create the bag of words for positive reviews
</span><span class="n">positive_bagofwords</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">min_df</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="s">'english'</span><span class="p">)</span>
<span class="n">positive_bagofwords</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s">'Positive_Review'</span><span class="p">])</span>

<span class="c1"># transform the bag of words to a sparse matrix
</span><span class="n">positive_bagofwords_transfromed</span> <span class="o">=</span> <span class="n">positive_bagofwords</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s">'Positive_Review'</span><span class="p">])</span>

<span class="c1"># #Count the number of words the bag of words categorized
</span><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">' Positive review words identified </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">positive_bagofwords</span><span class="p">.</span><span class="n">get_feature_names_out</span><span class="p">())</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="c1"># Create a user friendly df from the bag of words and tag them as positive
</span><span class="n">positive_sparse_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">positive_bagofwords</span><span class="p">.</span><span class="n">get_feature_names_out</span><span class="p">(),</span> <span class="n">data</span><span class="o">=</span><span class="n">positive_bagofwords_transfromed</span><span class="p">.</span><span class="n">toarray</span><span class="p">()).</span><span class="n">add_prefix</span><span class="p">(</span><span class="s">'p_'</span><span class="p">,)</span>


</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Positive review words identified 2316
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#create a sparse matrix for the negative reviews
</span>
<span class="n">negative_bagofwords</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">min_df</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="s">'english'</span><span class="p">)</span>
<span class="n">negative_bagofwords</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s">'Negative_Review'</span><span class="p">])</span>

<span class="c1"># transform the bag of words to a sparse matrix
</span><span class="n">negative_bagofwords_transfromed</span> <span class="o">=</span> <span class="n">negative_bagofwords</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s">'Negative_Review'</span><span class="p">])</span>

<span class="c1">#Count the number of words the bag of words categorized
</span><span class="nb">len</span><span class="p">(</span><span class="n">negative_bagofwords</span><span class="p">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>

<span class="c1"># Create a user friendly df from the bag of words
</span><span class="n">negative_sparse_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">negative_bagofwords</span><span class="p">.</span><span class="n">get_feature_names_out</span><span class="p">(),</span> <span class="n">data</span><span class="o">=</span><span class="n">negative_bagofwords_transfromed</span><span class="p">.</span><span class="n">toarray</span><span class="p">()).</span><span class="n">add_prefix</span><span class="p">(</span><span class="s">'n_'</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># combine the three dataframes
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clean_df</span><span class="p">,</span><span class="n">positive_sparse_df</span><span class="p">,</span> <span class="n">negative_sparse_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Look for duplicate columns
</span><span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">duplicated</span><span class="p">()])</span>

<span class="c1"># Show the final dataframe shape
</span><span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">' Final dataframe shape: </span><span class="si">{</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Index([], dtype='object')
 Final dataframe shape: (51574, 5304)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Save the final dataframe to CSV
</span><span class="n">df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'data/clean_hotel_data_1.csv'</span><span class="p">)</span>
</code></pre></div></div>

<p>Working through this process has been a great chance to begin to understand what it takes to preprocess data for natural language processing. After the straightforward data cleaning, getting into parsing text data is a new area for me to explore. I would like to work on the sparse matrices to further remove some of the extraneous terms. My initial approach was to look for words that appear in at least 10 reviews and remove a basic set of stop words in English. My next steps would be adding stemming techniques and looking for ngrams to make the sparse matrices smaller and have more impactful terms.</p>

<p>There is still some unfinished business with the core of the data. Making use of the tags and hotel address information could be insightful for a more detailed modeling. There may be information about the length of stay, reason for travel, or other information that could give context to the reviews. Once I parse the hotel address I would be able to fill in the missing latitude and longitude coordinate. Having the country data available would also allow us to determine whether international travelers may have different concerns when choosing a hotel.</p>

<p>I need to check the core data for collinearity before modeling begins. Removing correlated columns will improve the models over-fitting.</p>

<p>The next post about this project will pick up with the cleaned dataset. I will explore several different machine learning models and see if I can model what makes a review positive or negative.</p>


  </div>

  <!-- <div class="date">
    Upd on January  1, 2023
  </div> -->

  
</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:russkibat@pm.me"><i class="svg-icon email"></i></a>


<a href="https://github.com//russ-kibat/"><i class="svg-icon github"></i></a>

<a href="https://www.linkedin.com/in//russkibat/"><i class="svg-icon linkedin"></i></a>






        </footer>
      </div>
    </div>

    

  </body>
</html>
